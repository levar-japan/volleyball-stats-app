rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // teamsコレクションに対するルール
    match /teams/{teamId} {
      // チームコードを検証するために、未認証ユーザーでも読み取り（get, list）を許可する
      allow get, list: if true;

      // ただし、チームの作成、更新、削除は認証されたユーザーのみ許可する
      allow create, update, delete: if request.auth != null;
    }

    // teamsのサブコレクション（players, matches, seasonsなど）に対するルール
    match /teams/{teamId}/{document=**} {
      // 認証されたユーザー（匿名認証を含む）は読み書き可能
      // 匿名認証も認証済みユーザーとして扱われるため、request.auth != null でチェック
      allow read, write: if request.auth != null;
    }
    
    // デフォルト: その他のコレクションへのアクセスは拒否
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
